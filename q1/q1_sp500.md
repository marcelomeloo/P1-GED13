# Prova 1 de GED13
## ***Questão 1***
### Inicialização

```r
  library(tidyverse)
  library(ggplot2)
  library(quantmod) # Para usar o "getSymbols"
  library(data.table) # Para usar o "shift"
  library(ggpubr) # Para usar o "ggarrange" e "annotate_figure"
  library(cowplot) # Para fazer "qqplot" junto com histograma
  library(gridExtra) # Para inserir tabela no "qqplot"
  start <- as.Date("2022-01-01")
  end <- as.Date("2022-09-01")
```
### Dados do SP 500

```r
  dados.sp500 <- quantmod::getSymbols("^GSPC", src = "yahoo", from = start, to = end, auto.assign = FALSE)
  dados.sp500
```

```
##            GSPC.Open GSPC.High GSPC.Low GSPC.Close GSPC.Volume GSPC.Adjusted
## 2022-01-03   4778.14   4796.64  4758.17    4796.56  2775190000       4796.56
## 2022-01-04   4804.51   4818.62  4774.27    4793.54  3641050000       4793.54
## 2022-01-05   4787.99   4797.70  4699.44    4700.58  3733540000       4700.58
## 2022-01-06   4693.39   4725.01  4671.26    4696.05  3371250000       4696.05
## 2022-01-07   4697.66   4707.95  4662.74    4677.03  3279870000       4677.03
## 2022-01-10   4655.34   4673.02  4582.24    4670.29  3621800000       4670.29
## 2022-01-11   4669.14   4714.13  4638.27    4713.07  3421600000       4713.07
## 2022-01-12   4728.59   4748.83  4706.71    4726.35  3060040000       4726.35
## 2022-01-13   4733.56   4744.13  4650.29    4659.03  3539830000       4659.03
## 2022-01-14   4637.99   4665.13  4614.75    4662.85  3483530000       4662.85
## 2022-01-18   4632.24   4632.24  4568.70    4577.11  3324960000       4577.11
## 2022-01-19   4588.03   4611.55  4530.20    4532.76  3387370000       4532.76
## 2022-01-20   4547.35   4602.11  4477.95    4482.73  3473060000       4482.73
## 2022-01-21   4471.38   4494.52  4395.34    4397.94  3945810000       4397.94
## 2022-01-24   4356.32   4417.35  4222.62    4410.13  5172540000       4410.13
## 2022-01-25   4366.64   4411.01  4287.11    4356.45  3989420000       4356.45
## 2022-01-26   4408.43   4453.23  4304.80    4349.93  4046270000       4349.93
## 2022-01-27   4380.58   4428.74  4309.50    4326.51  4074330000       4326.51
## 2022-01-28   4336.19   4432.72  4292.46    4431.85  3936030000       4431.85
## 2022-01-31   4431.79   4516.89  4414.02    4515.55  4001950000       4515.55
## 2022-02-01   4519.57   4550.49  4483.53    4546.54  3796450000       4546.54
## 2022-02-02   4566.39   4595.31  4544.32    4589.38  3777170000       4589.38
## 2022-02-03   4535.41   4542.88  4470.39    4477.44  3596830000       4477.44
## 2022-02-04   4482.79   4539.66  4451.50    4500.53  3673700000       4500.53
## 2022-02-07   4505.75   4521.86  4471.47    4483.87  3291600000       4483.87
## 2022-02-08   4480.02   4531.32  4465.40    4521.54  3509330000       4521.54
## 2022-02-09   4547.00   4590.03  4547.00    4587.18  3662810000       4587.18
## 2022-02-10   4553.24   4588.92  4484.31    4504.08  4490500000       4504.08
## 2022-02-11   4506.27   4526.33  4401.41    4418.64  4164960000       4418.64
## 2022-02-14   4412.61   4426.22  4364.84    4401.67  3466170000       4401.67
## 2022-02-15   4429.28   4472.77  4429.28    4471.07  3363200000       4471.07
## 2022-02-16   4455.75   4489.55  4429.68    4475.01  3478750000       4475.01
## 2022-02-17   4456.06   4456.06  4373.81    4380.26  3596510000       4380.26
## 2022-02-18   4384.57   4394.60  4327.22    4348.87  3871340000       4348.87
## 2022-02-22   4332.74   4362.12  4267.11    4304.76  4007780000       4304.76
## 2022-02-23   4324.93   4341.51  4221.51    4225.50  3814340000       4225.50
## 2022-02-24   4155.77   4294.73  4114.65    4288.70  5070560000       4288.70
## 2022-02-25   4298.38   4385.34  4286.83    4384.65  3941780000       4384.65
## 2022-02-28   4354.17   4388.84  4315.12    4373.94  4594010000       4373.94
## 2022-03-01   4363.14   4378.45  4279.54    4306.26  4679400000       4306.26
## 2022-03-02   4322.56   4401.48  4322.56    4386.54  4409090000       4386.54
## 2022-03-03   4401.31   4416.78  4345.56    4363.49  4062080000       4363.49
## 2022-03-04   4342.12   4342.12  4284.98    4328.87  4558250000       4328.87
## 2022-03-07   4327.01   4327.01  4199.85    4201.09  5506330000       4201.09
## 2022-03-08   4202.66   4276.94  4157.87    4170.70  6237000000       4170.70
## 2022-03-09   4223.10   4299.40  4223.10    4277.88  4220180000       4277.88
## 2022-03-10   4252.55   4268.28  4209.80    4259.52  4008690000       4259.52
## 2022-03-11   4279.50   4291.01  4200.49    4204.31  3877430000       4204.31
## 2022-03-14   4202.75   4247.57  4161.72    4173.11  4757600000       4173.11
## 2022-03-15   4188.82   4271.05  4187.90    4262.45  4331170000       4262.45
## 2022-03-16   4288.14   4358.90  4251.99    4357.86  5002240000       4357.86
## 2022-03-17   4345.11   4412.67  4335.65    4411.67  4174170000       4411.67
## 2022-03-18   4407.34   4465.40  4390.57    4463.12  6681510000       4463.12
## 2022-03-21   4462.40   4481.75  4424.30    4461.18  3961050000       4461.18
## 2022-03-22   4469.10   4522.00  4469.10    4511.61  3962880000       4511.61
## 2022-03-23   4493.10   4501.07  4455.81    4456.24  4014360000       4456.24
## 2022-03-24   4469.98   4520.58  4465.17    4520.16  3573430000       4520.16
## 2022-03-25   4522.91   4546.03  4501.07    4543.06  3577520000       4543.06
## 2022-03-28   4541.09   4575.65  4517.69    4575.52  3696850000       4575.52
## 2022-03-29   4602.86   4637.30  4589.66    4631.60  4239660000       4631.60
## 2022-03-30   4624.20   4627.77  4581.32    4602.45  3665390000       4602.45
## 2022-03-31   4599.02   4603.07  4530.41    4530.41  3782040000       4530.41
## 2022-04-01   4540.32   4548.70  4507.57    4545.86  3828290000       4545.86
## 2022-04-04   4547.97   4583.50  4539.21    4582.64  3833500000       4582.64
## 2022-04-05   4572.45   4593.45  4514.17    4525.12  3906230000       4525.12
## 2022-04-06   4494.17   4503.94  4450.04    4481.15  4137080000       4481.15
## 2022-04-07   4474.65   4521.16  4450.30    4500.21  4054010000       4500.21
## 2022-04-08   4494.15   4520.41  4474.60    4488.28  3453040000       4488.28
## 2022-04-11   4462.64   4464.35  4408.38    4412.53  3452540000       4412.53
## 2022-04-12   4437.59   4471.00  4381.34    4397.45  3451990000       4397.45
## 2022-04-13   4394.30   4453.92  4392.70    4446.59  3273140000       4446.59
## 2022-04-14   4449.12   4460.46  4390.77    4392.59  3634740000       4392.59
## 2022-04-18   4385.63   4410.31  4370.30    4391.69  3509340000       4391.69
## 2022-04-19   4390.63   4471.03  4390.63    4462.21  3197930000       4462.21
## 2022-04-20   4472.26   4488.29  4448.76    4459.45  3678040000       4459.45
## 2022-04-21   4489.17   4512.94  4384.47    4393.66  3833570000       4393.66
## 2022-04-22   4385.83   4385.83  4267.62    4271.78  3930660000       4271.78
## 2022-04-25   4255.34   4299.02  4200.82    4296.12  4061070000       4296.12
## 2022-04-26   4278.14   4278.14  4175.04    4175.20  3760420000       4175.20
## 2022-04-27   4186.52   4240.71  4162.90    4183.96  3876340000       4183.96
## 2022-04-28   4222.58   4308.45  4188.63    4287.50  3969440000       4287.50
## 2022-04-29   4253.75   4269.68  4124.28    4131.93  3943480000       4131.93
## 2022-05-02   4130.61   4169.81  4062.51    4155.38  4474060000       4155.38
## 2022-05-03   4159.78   4200.10  4147.08    4175.48  3877530000       4175.48
## 2022-05-04   4181.18   4307.66  4148.91    4300.17  4236210000       4300.17
## 2022-05-05   4270.43   4270.43  4106.01    4146.87  4197620000       4146.87
## 2022-05-06   4128.17   4157.69  4067.91    4123.34  4254300000       4123.34
## 2022-05-09   4081.27   4081.27  3975.48    3991.24  4746120000       3991.24
## 2022-05-10   4035.18   4068.82  3958.17    4001.05  4630150000       4001.05
## 2022-05-11   3990.08   4049.09  3928.82    3935.18  4683220000       3935.18
## 2022-05-12   3903.95   3964.80  3858.87    3930.08  4964130000       3930.08
## 2022-05-13   3963.90   4038.88  3963.90    4023.89  4142950000       4023.89
## 2022-05-16   4013.02   4046.46  3983.99    4008.01  3824320000       4008.01
## 2022-05-17   4052.00   4090.72  4033.93    4088.85  3846580000       4088.85
## 2022-05-18   4051.98   4051.98  3911.91    3923.68  4428960000       3923.68
## 2022-05-19   3899.00   3945.96  3876.58    3900.79  4212140000       3900.79
## 2022-05-20   3927.76   3943.42  3810.32    3901.36  4278520000       3901.36
## 2022-05-23   3919.42   3981.88  3909.04    3973.75  3392770000       3973.75
## 2022-05-24   3942.94   3955.68  3875.13    3941.48  3901640000       3941.48
## 2022-05-25   3929.59   3999.33  3925.03    3978.73  4322190000       3978.73
## 2022-05-26   3984.60   4075.14  3984.60    4057.84  3961940000       4057.84
## 2022-05-27   4077.43   4158.49  4077.43    4158.24  3560560000       4158.24
## 2022-05-31   4151.09   4168.34  4104.88    4132.15  5192220000       4132.15
## 2022-06-01   4149.78   4166.54  4073.85    4101.23  4145710000       4101.23
## 2022-06-02   4095.41   4177.51  4074.37    4176.82  3604930000       4176.82
## 2022-06-03   4137.57   4142.67  4098.67    4108.54  3107080000       4108.54
## 2022-06-06   4134.72   4168.78  4109.18    4121.43  3852050000       4121.43
## 2022-06-07   4096.47   4164.86  4080.19    4160.68  3476470000       4160.68
## 2022-06-08   4147.12   4160.14  4107.20    4115.77  3090180000       4115.77
## 2022-06-09   4101.65   4119.10  4017.17    4017.82  3192330000       4017.82
## 2022-06-10   3974.39   3974.39  3900.16    3900.86  3936120000       3900.86
## 2022-06-13   3838.15   3838.15  3734.30    3749.63  4572820000       3749.63
## 2022-06-14   3763.52   3778.18  3705.68    3735.48  4126400000       3735.48
## 2022-06-15   3764.05   3837.56  3722.30    3789.99  4474610000       3789.99
## 2022-06-16   3728.18   3728.18  3639.77    3666.77  4511200000       3666.77
## 2022-06-17   3665.90   3707.71  3636.87    3674.84  6954110000       3674.84
## 2022-06-21   3715.31   3779.65  3715.31    3764.79  4124600000       3764.79
## 2022-06-22   3733.89   3801.79  3717.69    3759.89  4342270000       3759.89
## 2022-06-23   3774.71   3802.58  3743.52    3795.73  4078100000       3795.73
## 2022-06-24   3821.75   3913.65  3821.75    3911.74  6742870000       3911.74
## 2022-06-27   3920.76   3927.72  3889.66    3900.11  3385120000       3900.11
## 2022-06-28   3913.00   3945.86  3820.14    3821.55  3590980000       3821.55
## 2022-06-29   3825.09   3836.50  3799.02    3818.83  3458850000       3818.83
## 2022-06-30   3785.99   3818.99  3738.67    3785.38  4032260000       3785.38
## 2022-07-01   3781.00   3829.82  3752.10    3825.33  3268240000       3825.33
## 2022-07-05   3792.61   3832.19  3742.06    3831.39  4427900000       3831.39
## 2022-07-06   3831.98   3870.91  3809.37    3845.08  3613120000       3845.08
## 2022-07-07   3858.85   3910.63  3858.85    3902.62  3337710000       3902.62
## 2022-07-08   3888.26   3918.50  3869.34    3899.38  2844620000       3899.38
## 2022-07-11   3880.94   3880.94  3847.22    3854.43  3023830000       3854.43
## 2022-07-12   3851.95   3873.41  3802.36    3818.80  3138460000       3818.80
## 2022-07-13   3779.67   3829.44  3759.07    3801.78  3166580000       3801.78
## 2022-07-14   3763.99   3796.41  3721.56    3790.38  3447500000       3790.38
## 2022-07-15   3818.00   3863.62  3817.18    3863.16  3537130000       3863.16
## 2022-07-18   3883.79   3902.44  3818.63    3830.85  3414470000       3830.85
## 2022-07-19   3860.73   3939.81  3860.73    3936.69  3160350000       3936.69
## 2022-07-20   3935.32   3974.13  3922.03    3959.90  3452150000       3959.90
## 2022-07-21   3955.47   3999.29  3927.64    3998.95  3586030000       3998.95
## 2022-07-22   3998.43   4012.44  3938.86    3961.63  3246220000       3961.63
## 2022-07-25   3965.72   3975.30  3943.46    3966.84  2988650000       3966.84
## 2022-07-26   3953.22   3953.22  3910.74    3921.05  3083420000       3921.05
## 2022-07-27   3951.43   4039.56  3951.43    4023.61  3584170000       4023.61
## 2022-07-28   4026.13   4078.95  3992.97    4072.43  3882850000       4072.43
## 2022-07-29   4087.33   4140.15  4079.22    4130.29  3817740000       4130.29
## 2022-08-01   4112.38   4144.95  4096.02    4118.63  3540960000       4118.63
## 2022-08-02   4104.21   4140.47  4079.81    4091.19  3880790000       4091.19
## 2022-08-03   4107.96   4167.66  4107.96    4155.17  3544410000       4155.17
## 2022-08-04   4154.85   4161.29  4135.42    4151.94  3565810000       4151.94
## 2022-08-05   4115.87   4151.58  4107.31    4145.19  3540260000       4145.19
## 2022-08-08   4155.93   4186.62  4128.97    4140.06  3604650000       4140.06
## 2022-08-09   4133.11   4137.30  4112.09    4122.47  3337150000       4122.47
## 2022-08-10   4181.02   4211.03  4177.26    4210.24  3998590000       4210.24
## 2022-08-11   4227.40   4257.91  4201.41    4207.27  3925060000       4207.27
## 2022-08-12   4225.02   4280.47  4219.78    4280.15  3252290000       4280.15
## 2022-08-15   4269.37   4301.79  4256.90    4297.14  3087740000       4297.14
## 2022-08-16   4290.46   4325.28  4277.77    4305.20  3792010000       4305.20
## 2022-08-17   4280.40   4302.18  4253.08    4274.04  3293430000       4274.04
## 2022-08-18   4273.13   4292.53  4261.98    4283.74  2871990000       4283.74
## 2022-08-19   4266.31   4266.31  4218.70    4228.48  3210680000       4228.48
## 2022-08-22   4195.08   4195.08  4129.86    4137.99  3365220000       4137.99
## 2022-08-23   4133.09   4159.77  4124.03    4128.73  3117800000       4128.73
## 2022-08-24   4126.55   4156.56  4119.97    4140.77  3056910000       4140.77
## 2022-08-25   4153.26   4200.54  4147.59    4199.12  2976050000       4199.12
## 2022-08-26   4198.74   4203.04  4057.66    4057.66  3175260000       4057.66
## 2022-08-29   4034.58   4062.99  4017.42    4030.61  2963020000       4030.61
## 2022-08-30   4041.25   4044.98  3965.21    3986.16  3190580000       3986.16
## 2022-08-31   4000.67   4015.37  3954.53    3955.00  3797860000       3955.00
```

```r
  nasdaq <- na.omit(dados.nasdaq)
```

```
## Error in na.omit(dados.nasdaq): object 'dados.nasdaq' not found
```

#### Cria o vetor de preco de fechamento

```r
  preco_fechamento <- dados.sp500$"GSPC.Close"
```

#### 1. Media do Preco de Fechamento

```r
  media_pf <- mean(preco_fechamento)
  media_pf
```

```
## [1] 4222.706
```

#### 2. Moda do Preco de Fechamento 

```r
  tab_preco_fechamento <- table(preco_fechamento)
  moda_pf <- names(tab_preco_fechamento)[which(tab_preco_fechamento==max(tab_preco_fechamento))]
  moda_pf
```

```
##   [1] "3666.77002"  "3674.840088" "3735.47998"  "3749.629883" "3759.889893" "3764.790039" "3785.379883" "3789.98999"  "3790.379883" "3795.72998"  "3801.780029" "3818.800049" "3818.830078"
##  [14] "3821.550049" "3825.330078" "3830.850098" "3831.389893" "3845.080078" "3854.429932" "3863.159912" "3899.379883" "3900.110107" "3900.790039" "3900.860107" "3901.360107" "3902.620117"
##  [27] "3911.73999"  "3921.050049" "3923.679932" "3930.080078" "3935.179932" "3936.689941" "3941.47998"  "3955"        "3959.899902" "3961.629883" "3966.840088" "3973.75"     "3978.72998" 
##  [40] "3986.159912" "3991.23999"  "3998.949951" "4001.050049" "4008.01001"  "4017.820068" "4023.610107" "4023.889893" "4030.610107" "4057.659912" "4057.840088" "4072.429932" "4088.850098"
##  [53] "4091.189941" "4101.22998"  "4108.540039" "4115.77002"  "4118.629883" "4121.430176" "4122.470215" "4123.339844" "4128.72998"  "4130.290039" "4131.930176" "4132.149902" "4137.990234"
##  [66] "4140.060059" "4140.77002"  "4145.189941" "4146.870117" "4151.939941" "4155.169922" "4155.379883" "4158.240234" "4160.680176" "4170.700195" "4173.109863" "4175.200195" "4175.47998" 
##  [79] "4176.819824" "4183.959961" "4199.120117" "4201.089844" "4204.310059" "4207.27002"  "4210.240234" "4225.5"      "4228.47998"  "4259.52002"  "4262.450195" "4271.779785" "4274.040039"
##  [92] "4277.879883" "4280.149902" "4283.740234" "4287.5"      "4288.700195" "4296.120117" "4297.140137" "4300.169922" "4304.759766" "4305.200195" "4306.259766" "4326.509766" "4328.870117"
## [105] "4348.870117" "4349.930176" "4356.450195" "4357.859863" "4363.490234" "4373.939941" "4380.259766" "4384.649902" "4386.540039" "4391.689941" "4392.589844" "4393.660156" "4397.450195"
## [118] "4397.939941" "4401.669922" "4410.129883" "4411.669922" "4412.529785" "4418.640137" "4431.850098" "4446.589844" "4456.240234" "4459.450195" "4461.180176" "4462.209961" "4463.120117"
## [131] "4471.069824" "4475.009766" "4477.439941" "4481.149902" "4482.72998"  "4483.870117" "4488.279785" "4500.209961" "4500.529785" "4504.080078" "4511.609863" "4515.549805" "4520.160156"
## [144] "4521.540039" "4525.120117" "4530.410156" "4532.759766" "4543.060059" "4545.859863" "4546.540039" "4575.52002"  "4577.109863" "4582.640137" "4587.180176" "4589.379883" "4602.450195"
## [157] "4631.600098" "4659.029785" "4662.850098" "4670.290039" "4677.029785" "4696.049805" "4700.580078" "4713.069824" "4726.350098" "4793.540039" "4796.560059"
```

#### 3. Mediana do Preco de Fechamento 

```r
  mediana_pf <- median(preco_fechamento)
  mediana_pf
```

```
## [1] 4207.27
```

#### 4. Variancia Nao Viesada 

```r
  variancia_pf <- var(preco_fechamento)
  variancia_pf
```

```
##            GSPC.Close
## GSPC.Close   72749.01
```

#### 5. Desvio-padrao 

```r
  desv_pad_pf <- sd(preco_fechamento)
  desv_pad_pf
```

```
## [1] 269.7202
```

#### 6. Grafico de linha do Preco de Fechamento 

```r
  ggplot(dados.dj, aes(x = index(dados.dj), y = preco_fechamento)) + geom_line() +
        labs(title="Grafico do SP 500", subtitle="Preco de Fechamento", caption="Fonte: https://finance.yahoo.com/", x = "Data ", y="Preco (R$)") +
        theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5)) +
        scale_x_date(date_labels = "%b %y", date_breaks = "1 month")
```

```
## Error in ggplot(dados.dj, aes(x = index(dados.dj), y = preco_fechamento)): object 'dados.dj' not found
```

#### 7. Retorno, com base no Preco de Fechamento 

```r
  retorno_pf <- (preco_fechamento - shift(preco_fechamento, 1L, type="lag"))/shift(preco_fechamento, 1L, type="lag")
  retorno_pf <- na.omit(retorno_pf)
  tabela_preco_retorno <- cbind(preco_fechamento, retorno_pf)
  head(tabela_preco_retorno)
```

```
##            GSPC.Close  GSPC.Close.1
## 2022-01-03    4796.56            NA
## 2022-01-04    4793.54 -0.0006296221
## 2022-01-05    4700.58 -0.0193927578
## 2022-01-06    4696.05 -0.0009637689
## 2022-01-07    4677.03 -0.0040502168
## 2022-01-10    4670.29 -0.0014410312
```

#### 8. Grafico de linha do Retorno 

```r
  ggplot(retorno_pf, aes(x = index(retorno_pf), y = 100*retorno_pf)) + geom_line() +
        labs(title="Grafico do SP 500", subtitle="Retorno", caption="Fonte: https://finance.yahoo.com/", x = "Data ", y="Retorno (%)") +
        theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5)) +
        scale_x_date(date_labels = "%b %y", date_breaks = "1 month")
```

```
## Don't know how to automatically pick scale for object of type xts/zoo. Defaulting to continuous.
```

![plot of chunk unnamed-chunk-11](figure/unnamed-chunk-11-1.png)

#### 9. Box plot para dados originais (Preco de Fechamento e Retorno) e padronizados 

```r
  boxplot_pf <- ggplot(data = preco_fechamento, aes(x = "", y = preco_fechamento))+
                      geom_violin(trim = FALSE, color="blue") +
                      geom_boxplot(width=0.4, color="blue", alpha = 1, outlier.size = 1) +
                      labs(x = "Preco", y = "") +
                      scale_y_continuous(breaks = seq(16, 23, by = 1))

  z_preco_fechamento <- (preco_fechamento - mean(preco_fechamento)) / sd(preco_fechamento)

  boxplot_z_pf <- ggplot(data = z_preco_fechamento, aes(x = "", y = z_preco_fechamento)) +
                        geom_violin(trim = FALSE, color="goldenrod3") +
                        geom_boxplot(width=0.4, color="red", alpha = 1, outlier.size = 1)+
                        labs(x = "Preco Padronizado", y = "") +
                        scale_y_continuous(breaks = seq(-5, 23, by = 1))

  boxplots_pf <- ggarrange(boxplot_pf, boxplot_z_pf,ncol = 2, nrow = 1)
  annotate_figure(boxplots_pf, top = text_grob("Boxplot/Vioplot do Preco de Fechamento\ne Preco de Fechamento Padronizado", color = "Black", face = "bold", size = 14),
                  bottom = text_grob("Fonte: https://finance.yahoo.com/", color = "black", hjust = 1.02, x = 1,size = 10))
```

![plot of chunk unnamed-chunk-12](figure/unnamed-chunk-12-1.png)

```r
  boxplot_retorno <- ggplot(data = retorno_pf, aes(x = "", y = 100*retorno_pf)) +
                            geom_violin(trim = FALSE, color="blue") +
                            geom_boxplot(width=0.4, color="blue", alpha = 1, outlier.size = 1) +
                            labs(x = "Retorno (%)", y = "") +
                            scale_y_continuous(breaks = seq(-7, 6, by = 2))

  z_retorno_pf <- (retorno_pf - mean(retorno_pf))/(sd(retorno_pf))

  boxplot_z_retorno_pf <- ggplot(data = z_retorno_pf, aes(x = "", y = z_retorno_pf)) +
                            geom_violin(trim = FALSE, color="red") +
                            geom_boxplot(width=0.4, color="red", alpha = 1, outlier.size = 1) +
                            labs(x = "Retorno Padronizado", y = "") +
                            scale_y_continuous(breaks = seq(-3, 11, by = 2))

  boxplots_retorno <- ggarrange(boxplot_retorno, boxplot_z_retorno_pf,ncol = 2, nrow = 1)
  annotate_figure(boxplots_retorno, top = text_grob("Boxplot/Vioplot do Retorno\ne Retorno Padronizado",
                  color = "Black", face = "bold", size = 14),
                  bottom = text_grob("Fonte: https://finance.yahoo.com/",
                  color = "black", hjust = 1.02, x = 1, size = 10))
```

![plot of chunk unnamed-chunk-12](figure/unnamed-chunk-12-2.png)


#### 10. Histograma para dados originais (Preco de Fechamento e Retorno) e padronizados 

```r
  histograma_pf <- ggplot(data = preco_fechamento,aes(x = preco_fechamento)) +
                          geom_histogram(color="blue", fill = "white", bins = 30) +
                          labs(y = "Quantidade", x = "Preco") +
                          scale_x_continuous(breaks = seq(17, 22, by = 0.5)) +
                          scale_y_continuous(breaks = seq(0, 30, by = 5)) +
                          theme(plot.title = element_text(hjust = 0.5))

  histograma_z_pf <- ggplot(data = z_preco_fechamento,aes(x = z_preco_fechamento)) +
                            geom_histogram(color="red", fill = "white", bins = 30) +
                            labs(y = "Quantidade", x = "Preco Padronizado") +
                            scale_x_continuous(breaks = seq(-2, 3.5, by = 0.5)) +
                            scale_y_continuous(breaks = seq(0, 50, by = 5)) +
                            theme(plot.title = element_text(hjust = 0.5))

  histogramas_pf <- ggarrange(histograma_pf, histograma_z_pf,ncol = 1, nrow = 2)
  annotate_figure(histogramas_pf, top = text_grob("Histograma do Preco de Fechamento",
                  color = "Black", face = "bold", size = 14),
                  bottom = text_grob("Fonte: https://finance.yahoo.com/",
                  color = "black", hjust = 1.02, x = 1, size = 10))
```

![plot of chunk unnamed-chunk-13](figure/unnamed-chunk-13-1.png)

```r
  histograma_retorno <- ggplot(data = retorno_pf,aes(x = 100*retorno_pf)) + 
                                geom_histogram(color="blue", fill = "white", bins = 25) + 
                                labs(y = "Quantidade", x = "Retorno (%)") + 
                                scale_x_continuous(breaks = seq(-6, 6, by = 1)) + 
                                scale_y_continuous(breaks = seq(0, 40, by = 5)) + 
                                theme(plot.title = element_text(hjust = 0.5))

  histograma_z_retorno <- ggplot(data = z_retorno_pf ,aes(x = z_retorno_pf)) + 
                                geom_histogram(color="red", fill = "white", bins = 25) + 
                                labs(y = "Quantidade", x = "Retorno Padronizado") + 
                                scale_x_continuous(breaks = seq(-6, 6, by = 1)) + 
                                scale_y_continuous(breaks = seq(0, 35, by = 5)) + 
                                theme(plot.title = element_text(hjust = 0.5))

  histogramas_retorno <- ggarrange(histograma_retorno, histograma_z_retorno,ncol = 1, nrow = 2)
  annotate_figure(histogramas_retorno, top = text_grob("Histograma do Retorno",
                  color = "Black", face = "bold", size = 14),
                  bottom = text_grob("Fonte: https://finance.yahoo.com/",
                  color = "black", hjust = 1.02, x = 1, size = 10))
```

![plot of chunk unnamed-chunk-13](figure/unnamed-chunk-13-2.png)

#### 11. QQPlot do retorno.  

```r
  qqplot_retorno <- ggplot(data = retorno_pf, aes(sample = 100*as.vector(retorno_pf))) +
                          stat_qq(size = 0.6) +labs(x = "Quantis Teoricos", y = "Quantis Amostrais",
                          title = "QQPlot do Retorno (%)") + theme(plot.title = element_text(hjust = 0.5)) +
                          scale_y_continuous(breaks = seq(-6, 4.5, by = 1.5))
```

#### 12. QQLine do retorno (fazer junto com o QQPlot).  

```r
  histograma_retorno_qqplot <- ggplot(data = retorno_pf,aes(x = 100*retorno_pf)) +
                                      geom_histogram(aes(y=..density..),color="blue", fill = "white", bins = 25) +
                                      stat_function(fun = dnorm, args = list(mean = mean(100*retorno_pf), sd = sd(100*retorno_pf)),
                                      col="red",lwd=1)+ theme(axis.text.x = element_blank(), axis.text.y = element_blank()) +
                                      labs(y = "", x = "") 

  qqplot_linha_retorno <- ggplot(data = retorno_pf, aes(sample = 100*as.vector(retorno_pf))) +
                                stat_qq(size = 0.6) + labs(x = "Quantis Teoricos", y = "Quantis Amostrais", title = "QQPlot do Retorno (%)") +
                                theme(plot.title = element_text(hjust = 0.5)) +scale_y_continuous(breaks = seq(-6, 4.5, by = 1.5)) +
                                stat_qq_line(col = 2,lwd=1,lty=1) 

  plot_principal <- qqplot_linha_retorno

  plot_para_inserir <- histograma_retorno_qqplot

  plot.com.insercao <- ggdraw() + draw_plot(plot_principal) + draw_plot(plot_para_inserir, x = 0.07, y = 0.6, width = .3, height = .3)
```

```
## Don't know how to automatically pick scale for object of type xts/zoo. Defaulting to continuous.
```

```r
  plot.com.insercao
```

![plot of chunk unnamed-chunk-15](figure/unnamed-chunk-15-1.png)

#### 13. Assimetria amostral nao viesada do retorno.   

```r
  n <- length(retorno_pf)
  somatorio <- c()
  for(i in 1:n){
    somatorio[i] <- ((retorno_pf[i] - mean(retorno_pf))/ sd(retorno_pf))^3
  }
  p1_s3 <- n/((n -1)*(n-2))
  p2_s3 <- sum(somatorio)
  s3 <- p1_s3*p2_s3
  s3
```

```
## [1] -0.212796
```

#### 14. Curtose amostral nao viesada do retorno.   

```r
  n <- length(retorno_pf)
  somatorio <- c()
  for(i in 1:n){
    somatorio[i] <- ((retorno_pf[i] - mean(retorno_pf))/ sd(retorno_pf))^4
  }
  p1_s4 <- (n*(n +1))/((n -1)*(n-2)*(n-3))
  p2_s4 <- (sum(somatorio))
  p3_s4 <- (3*((n-1)^2))/((n-2)*(n-3))
  s4 <- p1_s4 * p2_s4 - p3_s4
  s4
```

```
## [1] -0.1196638
```



```r
  library("knitr")
  knit("./q1/q1_sp500.rmd", output = "./q1/q1_sp500.md")
```

```
## Warning in file(con, "r"): cannot open file './q1/q1_sp500.rmd': No such file or directory
```

```
## Error in file(con, "r"): cannot open the connection
```
